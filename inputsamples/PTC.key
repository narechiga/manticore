\annotations{
	ball(x1, x2, x3, x4) < 0.01;
}


\functions{
	R sqrt( R );
}


\problem{
	\[
	R p, r, pest, i;
	R u1hat; 
	R M;
	R c1, c2, c3, c4, c5, c6, c7, c8, c9, c10, c11, c12, c13, c14, c15, c16; 

	R a, b, c, d;
	R t;

	/*c1 := 0.41328;
	c2 := 200;
	c3 := -0.366;
	c4 := 0.08979;
	c5 := -0.0337;
	c6 := 0.0001;
	c7 := 2.821;
	c8 := -0.05231;
	c9 := 0.10299;
	c10 := -0.00063;
	c11 := 1;
	c12 := 14.7;
	c13 := 0.9;
	c14 := 0.4;
	c15 := 0.4;
	c16 := 1;
	u1hat := 23.0829;*/

	\](
	( 

        t = 0 
        & -0.001 <= p & p <= 0.001
        & -0.001 <= r & r <= 0.001

        & pest = 0
        & i = 0 
        & (M = 1) 

	/* The "universe" ball */
	& -0.2 <= p 	& p 	<= 0.2
	& -0.2 <= r 	& r 	<= 0.2
	& -0.2 <= pest 	& pest 	<= 0.2
	& -0.2 <= i 	& i 	<= 0.2

        /*& 5.7 <= a & a <= 5.8*/ 
        /*& 4 <= b & b <= 4.1  */
        /*& 2.7 <= c & c <= 2.8*/ 
        /*& 19 <= d & d <= 19.1*/

	
	)-> \[(
		/*========== Mode 1: Open loop ==========*/
	        (?M = 1;  
        	{
       			(\exists R dpdt; 
                	(\exists R drdt; 
                	(\exists R dpestdt; 
                	(p' = dpdt &
                	r' = drdt &
                	pest' = dpestdt & 
                	i' = 0 & 
                	t' = 1 
                	& t <= 0.008
                	&  -0.86 <= dpdt & dpdt <= 0.74
                	& -0.17 <= drdt & drdt <= 0.18
                	& -0.81 <= dpestdt & dpestdt <= 0.68

			/* The "universe" ball */
			& -0.2 <= p & p <= 0.2
			& -0.2 <= r & r <= 0.2
			& -0.2 <= pest & pest <= 0.2
			& -0.2 <= i & i <= 0.2
                	))))
        	})

		/*=========================================*/

		/*========== Switch modes ==========*/
		++( ?M = 1; M := 2 )	
		/*=========================================*/
		
		/*========== Mode 2: Closed loop ==========*/
		++(? M = 2; {
		p' = c1*( 
			2*u1hat*( (p + 0.89877559179912198425437882605416)/c11 - ((p + 0.89877559179912198425437882605416)/c11)^2)^(1/2) 
			- (c3 + c4*c2*(p + 0.89877559179912198425437882605416) 
			+ c5*c2*(p + 0.89877559179912198425437882605416)^2 
			+ c6*c2^2*(p + 0.89877559179912198425437882605416))),

		r' = 4*( 
				(c3 
				+ c4*c2*(p + 0.89877559179912198425437882605416) 
				+ c5*c2*(p + 0.89877559179912198425437882605416)^2 
				+ c6*c2^2*(p + 0.89877559179912198425437882605416) )
			/ ( 
				c13*( c3 + c4*c2*(pest + 1.0779564350547793288065542452819) + c5*c2*(pest + 1.0779564350547793288065542452819)^2 + c6*c2^2*(pest + 1.0779564350547793288065542452819)) 
				* ( 1 + (i - 0.000000000000000026901249610632059296110104185358) + c14 *((r + 1)-c16))
			) - (r + 1)),

		pest' = c1*( 
			2*u1hat*( (p + 0.89877559179912198425437882605416)/c11 - ((p + 0.89877559179912198425437882605416)/c11)^2)^(1/2) 
			- c13*(c3 + c4*c2*(pest + 1.0779564350547793288065542452819) 
			+ c5*c2*(pest + 1.0779564350547793288065542452819)^2 
			+ c6*c2^2*(pest + 1.0779564350547793288065542452819))),

		i' = c15*( (r + 1) - c16 )

			/* The "universe" ball */
			& -0.2 <= p 	& p 	<= 0.2
			& -0.2 <= r 	& r 	<= 0.2
			& -0.2 <= pest 	& pest	<= 0.2
			& -0.2 <= i 	& i	<= 0.2
		})
		/*=========================================*/

		++( ?( -0.1 > r | r > 0.1 | -0.1 > p | p > 0.1 | -0.1 > r | r > 0.1 | -0.1 > pest | pest > 0.1); M := -1 )


	)***\]
	
	( M != -1 )
	/*( -0.1 < r & r < 0.1 )*/
	

	)

}
/* finv cut 1
(M != -1) & 
(M = 2) & (99.934805708726017*p^2+30.339886475674035*p*r+94.495991596541188*r^2 -102.3691125523679*p*pest -6.562629260106581*r*pest+78.391449665619675*pest^2+12.239087490407609*p*i +124.4073333651007*r*i +17.911222272917040*pest*i+99.903784017029182*i^2 +112.0695133965872*p^3 +164.0214247448392*p^2*r +265.1170525779931*p*r^2 +117.5450776505406*p^2*pest-74.141318936015409*p*r*pest +150.8584700865144*p*pest^2 +79.181953117874130*p^2*i-34.235041669540777*p*r*i+74.362335300241483*p*pest*i-22.666085262177699*p*i^2 -112.8273267809297*r^3 +20.496363898469504*r^2*pest+54.272388601831665*r*pest^2 +104.6094922960270*r^2*i +189.0930199424112*r*pest*i +241.3461383612227*r*i^2 -29.567759407750348*pest^3-48.518449726917410*pest^2*i +227.5731267285588*pest*i^2 +9.580298198442543*i^3+96.980461809678161*p^4+86.269316079956894*p^3*r +107.8987093485224*p^2*r^2 +88.052697823010448*p^3*pest+7.214341070371347*p^2*r*pest +190.5665033864122*p^2*pest^2 +61.462396207073084*p^3*i-33.440953328230727*p^2*r*i +137.2451730836222*p^2*pest*i +199.5732260380376*p^2*i^2 -111.7599138195876*p*r^3 +129.6047817038538*p*r^2*pest +74.161072124436132*p*r*pest^2 +239.7873548020268*p*r^2*i +78.201856708041205*p*r*pest*i+67.125410772773023*p*r*i^2+98.845615003244788*r^4-10.395925305198430*r^3*pest+55.911769440291529*r^2*pest^2 -126.4148339952138*r^3*i -107.4775521819841*r^2*pest*i -40.404458982343229*r^2*i^2+88.138821954106191*p*pest^3-57.678478678496944*p*pest^2*i-77.999980781233290*p*pest*i^2+11.700342858897281*r*pest^3+35.383404352348457*r*pest^2*i +168.7128347312360*r*pest*i^2 +65.290148894616848*pest^4-7.688748807327043*pest^3*i +145.3654576987331*pest^2*i^2-17.189720066103177*p*i^3 +118.6994234571131*r*i^3+56.589920872974517*pest*i^3+99.245266674183057*i^4 <= 0.07 ) & -0.2 <= p & p <= 0.2 & -0.2 <= r & r <= 0.2 & -0.2 <= pest & pest <= 0.2 & -0.2 <= i & i <= 0.2 & t >= 0


*/

/* finv cut 2
(M != -1) & (t >= 0 & t <= 0.008 & p >= -0.86*t - 0.001 & p <= 0.74*t + 0.001 & r >= -0.17*t - 0.001 & r <= 0.18*t + 0.001 & pest <= 0.68*t & pest >= -0.81*t & i = 0 & -0.1 < r & r < 0.1)

/* shenanigans */
& -0.001 <= r & r <= 0.001) 
*/

/* bounds for dReal 
-1 <= p & p <= 1 & -1 <= r & r <= 1 & -1 <= pest & pest <= 1 & -1 <= i & i <= 1
*/


/*
sqrt arg is
(0.898775591799122 + x1) - (0.898775591799122 + x1)^2
1*(0.899 + x1) - 1*(0.899 + x1)^2
*/


/*

r' = 4*( (c3 + c4*c2*(p + 0.89877559179912198425437882605416) + c5*c2*(p + 0.89877559179912198425437882605416)^2 + c6*c2^2*(p + 0.89877559179912198425437882605416) )/ ( c13*( c3 + c4*c2*(pest + 1.0779564350547793288065542452819) + c5*c2*(pest + 1.0779564350547793288065542452819)^2 + c6*c2^2*(pest + 1.0779564350547793288065542452819)) * ( 1 )) - (r + 1)),


*/
/*
        c1 = 0.41328;
        c2 = 200;
        c3 = -0.366;
        c4 = 0.08979;
        c5 = -0.0337;
        c6 = 0.0001;
        c7 = 2.821;
        c8 = -0.05231;
        c9 = 0.10299;
        c10 = -0.00063;
        c11 = 1;
        c12 = 14.7;
        c13 = 0.9;
        c14 = 0.4;
        c15 = 0.4;
        c16 = 1;
        u1hat = 23.0829;
*/

/* dynamics substituted in 

fp = 19.079401823999998877070538583212*(- 1.0*p^2 + p)^(1/2) - 9.07480224*p + 2.7855072*p^2 + 0.15126048
fr = (4.0*(6.74*p^2 - 21.958*p + 0.366))/(6.066*pest^2 - 19.7622*pest + 0.3294) - 1.0*r
fpest  = 19.079401823999998877070538583212*(- 1.0*p^2 + p)^(1/2) - 8.167322016*pest + 2.50695648*pest^2 + 0.136134432

eq:
p : 0.89877559179912198425437882605416
r : 1 
pest : 1.0779564350547793288065542452819
i : -0.000000000000000026901249610632059296110104185358

*/

/*


		r' = 4*( (c3 + c4*c2*(p + 0.89877559179912198425437882605416) + c5*c2*(p + 0.89877559179912198425437882605416)^2 + c6*c2^2*(p + 0.89877559179912198425437882605416) ) / ( c13*( c3 + c4*c2*(pest + 1.0779564350547793288065542452819) + c5*c2*(pest + 1.0779564350547793288065542452819)^2 + c6*c2^2*(pest + 1.0779564350547793288065542452819)) * ( 1 + i + c14 *((r + 1)-c16))) - (r + 1)), 
		
		*/
